# è‡ªå®šä¹‰å­—æ®µåˆå¹¶æ¥å£ä½¿ç”¨è¯´æ˜

## ğŸ¯ é—®é¢˜è§£å†³

**è§£å†³åŒè¯·æ±‚é—®é¢˜**ï¼šå°†åŸæœ¬éœ€è¦çš„ä¸¤ä¸ªè¯·æ±‚åˆå¹¶ä¸ºä¸€ä¸ªï¼Œæå‡æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

### åŸæœ‰æ–¹æ¡ˆï¼ˆåŒè¯·æ±‚ï¼‰âŒ
```javascript
// è¯·æ±‚1ï¼šè·å–å­—æ®µå®šä¹‰
const definitions = await fetch('/api/v1/custom-fields/manage/basic?province=å¹¿ä¸œçœ')

// è¯·æ±‚2ï¼šè·å–å­—æ®µå€¼  
const values = await fetch('/api/v1/custom-fields/values/1?section=basic&province=å¹¿ä¸œçœ')

// å‰ç«¯æ‰‹åŠ¨åˆå¹¶æ•°æ®...
```

### æ–°æ–¹æ¡ˆï¼ˆå•è¯·æ±‚ï¼‰âœ…
```javascript
// ä¸€ä¸ªè¯·æ±‚è·å–å®Œæ•´æ•°æ®
const response = await fetch('/api/v1/custom-fields/values/1?section=basic&province=å¹¿ä¸œçœ&include_definitions=true')
```

## ğŸ“‹ APIè§„æ ¼è¯´æ˜

### ç«¯ç‚¹
```http
GET /api/v1/custom-fields/values/{unit_id}
```

### å‚æ•°
| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| `unit_id` | int | âœ… | å•ä½IDï¼ˆè·¯å¾„å‚æ•°ï¼‰ |
| `section` | string | âŒ | æ¿å—ç­›é€‰ï¼ˆbasic/early-batchç­‰ï¼‰ |
| `province` | string | âŒ | çœä»½ç­›é€‰ï¼ˆéœ€URLç¼–ç ï¼‰ |
| `include_definitions` | boolean | âŒ | æ˜¯å¦åŒ…å«å­—æ®µå®šä¹‰ï¼ˆé»˜è®¤falseï¼‰ |

### å“åº”æ ¼å¼

#### æ–°æ ¼å¼ï¼ˆinclude_definitions=trueï¼‰
```json
{
  "success": true,
  "data": {
    "fields": [
      {
        // å­—æ®µå®šä¹‰ä¿¡æ¯
        "field_id": 3,
        "field_name": "custom_1757226925033", 
        "display_name": "å‘å±•å‰æ™¯",
        "field_type": "text",
        "field_content": "æ¨¡æ¿å†…å®¹",
        "section": "basic",
        "province": "å¹¿ä¸œçœ",
        "is_required": false,
        "display_order": 1,
        "field_options": null,
        "validation_rules": null,
        "is_visible": true,
        
        // å­—æ®µå€¼ä¿¡æ¯
        "field_value": "å•ä½1çš„å‘å±•å‰æ™¯å†…å®¹",
        "value_updated_at": "2025-09-07T09:41:27.000Z",
        "has_value": true
      }
    ],
    "unit_id": 1,
    "total_fields": 3,
    "fields_with_values": 2,
    "filter_applied": {
      "section": "basic",
      "province": "å¹¿ä¸œçœ"
    }
  }
}
```

#### åŸæœ‰æ ¼å¼ï¼ˆinclude_definitions=falseï¼Œé»˜è®¤ï¼‰
```json
{
  "success": true, 
  "field_values": {
    "basic": [
      {
        "field_id": 3,
        "field_name": "custom_xxx",
        "display_name": "å‘å±•å‰æ™¯",
        "field_type": "text", 
        "field_value": "å•ä½1çš„å†…å®¹"
      }
    ]
  }
}
```

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### 1. è·å–å®Œæ•´å­—æ®µä¿¡æ¯ï¼ˆæ¨èï¼‰
```javascript
// è·å–å•ä½1çš„åŸºæœ¬æ¿å—å¹¿ä¸œçœå­—æ®µï¼ˆåŒ…å«å®šä¹‰å’Œå€¼ï¼‰
const response = await fetch('/api/v1/custom-fields/values/1?section=basic&province=å¹¿ä¸œçœ&include_definitions=true')
const data = await response.json()

if (data.success) {
  data.data.fields.forEach(field => {
    console.log(`${field.display_name}: ${field.field_value || 'æœªå¡«å†™'}`)
    console.log(`å­—æ®µç±»å‹: ${field.field_type}, æ˜¯å¦å¿…å¡«: ${field.is_required}`)
  })
}
```

### 2. æ‰¹é‡å­—æ®µç¼–è¾‘åœºæ™¯
```javascript
// åŠ è½½å­—æ®µè¿›è¡Œç¼–è¾‘
const loadFieldsForEdit = async (unitId) => {
  const response = await fetch(`/api/v1/custom-fields/values/${unitId}?section=basic&include_definitions=true`)
  const data = await response.json()
  
  return data.data.fields.map(field => ({
    fieldName: field.field_name,
    displayName: field.display_name, 
    fieldType: field.field_type,
    currentValue: field.field_value || '',
    isRequired: field.is_required,
    hasValue: field.has_value
  }))
}

// ä¿å­˜å­—æ®µå€¼ï¼ˆä½¿ç”¨ç°æœ‰PUTæ¥å£ï¼‰
const saveFieldValues = async (unitId, fieldValues) => {
  await fetch(`/api/v1/custom-fields/values/${unitId}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      section: 'basic',
      field_values: fieldValues
    })
  })
}
```

### 3. ä¸åŒæ¿å—çš„å­—æ®µç®¡ç†
```javascript
// è·å–ä¸åŒæ¿å—çš„å­—æ®µ
const sections = ['basic', 'early-batch', 'rural-grid', 'regional']

const fieldsBySection = {}
for (const section of sections) {
  const response = await fetch(`/api/v1/custom-fields/values/1?section=${section}&include_definitions=true`)
  const data = await response.json()
  fieldsBySection[section] = data.data.fields
}
```

### 4. çœä»½ç‰¹å®šå­—æ®µæ˜¾ç¤º
```javascript
// æ ¹æ®ç”¨æˆ·é€‰æ‹©çš„çœä»½æ˜¾ç¤ºç›¸å…³å­—æ®µ
const loadProvinceFields = async (unitId, province) => {
  const encodedProvince = encodeURIComponent(province)
  const response = await fetch(`/api/v1/custom-fields/values/${unitId}?province=${encodedProvince}&include_definitions=true`)
  
  return response.json()
}

// ç¤ºä¾‹ï¼šåŠ è½½å¹¿ä¸œçœçš„å­—æ®µ
const guangdongFields = await loadProvinceFields(1, 'å¹¿ä¸œçœ')
```

## ğŸ”§ å‘åå…¼å®¹æ€§

âœ… **å®Œå…¨å…¼å®¹**ï¼šç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹ï¼Œåªéœ€åœ¨éœ€è¦åˆå¹¶æ•°æ®æ—¶æ·»åŠ `include_definitions=true`å‚æ•°ã€‚

```javascript
// ç°æœ‰ä»£ç ç»§ç»­å·¥ä½œ
const oldWay = await fetch('/api/v1/custom-fields/values/1?section=basic')

// æ–°åŠŸèƒ½å¯é€‰å¯ç”¨
const newWay = await fetch('/api/v1/custom-fields/values/1?section=basic&include_definitions=true')
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ–¹æ¡ˆ | ç½‘ç»œè¯·æ±‚ | æ•°æ®ä¼ è¾“é‡ | å‰ç«¯å¤„ç†å¤æ‚åº¦ | ç”¨æˆ·ä½“éªŒ |
|------|----------|------------|----------------|----------|
| åŒè¯·æ±‚ï¼ˆåŸæœ‰ï¼‰ | 2æ¬¡ | è¾ƒé«˜ | é«˜ï¼ˆéœ€åˆå¹¶æ•°æ®ï¼‰ | è¾ƒæ…¢ |
| å•è¯·æ±‚ï¼ˆæ–°ï¼‰ | 1æ¬¡ | ä¼˜åŒ– | ä½ï¼ˆç›´æ¥ä½¿ç”¨ï¼‰ | âš¡å¿«é€Ÿ |

## ğŸ¨ æ•°æ®å­—æ®µè¯´æ˜

### å­—æ®µå®šä¹‰éƒ¨åˆ†
- `field_content`: å­—æ®µæ¨¡æ¿å†…å®¹ï¼ˆç®¡ç†å‘˜è®¾ç½®ï¼‰
- `display_name`: å­—æ®µæ˜¾ç¤ºåç§°
- `field_type`: å­—æ®µç±»å‹ï¼ˆtext/textarea/selectç­‰ï¼‰
- `is_required`: æ˜¯å¦å¿…å¡«
- `province`: çœä»½å½’å±

### å­—æ®µå€¼éƒ¨åˆ†
- `field_value`: è¯¥å•ä½çš„å®é™…å­—æ®µå€¼
- `has_value`: æ˜¯å¦æœ‰å€¼ï¼ˆå¸ƒå°”å€¼ï¼‰
- `value_updated_at`: å€¼çš„æ›´æ–°æ—¶é—´

## ğŸ” ç­›é€‰åŠŸèƒ½

æ”¯æŒçµæ´»çš„ç­›é€‰ç»„åˆï¼š

1. **æŒ‰æ¿å—ç­›é€‰**ï¼š`?section=basic`
2. **æŒ‰çœä»½ç­›é€‰**ï¼š`?province=å¹¿ä¸œçœ` 
3. **ç»„åˆç­›é€‰**ï¼š`?section=basic&province=å¹¿ä¸œçœ`
4. **è·å–å…¨éƒ¨**ï¼šä¸åŠ ç­›é€‰å‚æ•°

å‰ç«¯ç°åœ¨åªéœ€è¦ä¸€ä¸ªAPIè°ƒç”¨å³å¯è·å–å®Œæ•´çš„å­—æ®µä¿¡æ¯ï¼Œå¤§å¤§ç®€åŒ–äº†æ•°æ®å¤„ç†æµç¨‹ï¼