# 电网问答数据标签化工具使用说明

## 功能概述

这套工具用于对电网辅导问答数据进行标签化处理，主要功能包括：
1. **标签分类**：根据预设规则对问答内容进行分类标签
2. **问题补充**：为只有答案没有问题的记录自动生成问题
3. **数据库替换**：清空原数据库并用处理后的数据替换

## 文件说明

### 核心文件
- `knowledge_tagger.py` - 主要的标签化处理类
- `production_tagger.py` - 生产环境使用的命令行工具
- `test_tagger.py` - 测试脚本

### 标签分类规则

工具会根据以下预设分类进行标签化：

#### 地区类
国家电网、南方电网、各省电网等（共35个标签）

#### 内容类型
面试流程、面试技巧、录取要求、学历要求、专业要求等（共30个标签）

#### 学历层次
本科、硕士、博士、985高校、211高校、双一流等（共11个标签）

#### 专业领域
电气工程、电力系统、自动化、计算机等（共15个标签）

#### 难度等级
难度简单、难度中等、难度困难、难度极高

#### 时效性
2024年、2023年、2022年、往年经验、最新政策、历史数据

## 使用方法

### 1. 测试功能
```bash
python test_tagger.py
```
- 测试3条样例数据的标签化效果
- 结果保存到 `test_tagging_results.json`

### 2. 小批量测试
```bash
python knowledge_tagger.py
```
- 处理数据库中前5条记录
- 只保存文件，不替换数据库

### 3. 生产环境使用

#### 处理全部数据但不替换数据库（推荐先测试）
```bash
python production_tagger.py --limit 100
```

#### 处理全部数据并替换数据库（⚠️ 谨慎使用）
```bash
python production_tagger.py --replace-db
```

#### 自定义参数
```bash
python production_tagger.py \
  --limit 1000 \
  --offset 100 \
  --batch-size 10 \
  --replace-db \
  --proxy "socks5://user:pass@host:port"
```

### 参数说明
- `--limit`: 限制处理的记录数量，不指定则处理全部
- `--offset`: 从第几条记录开始处理（默认：0）
- `--batch-size`: 批处理大小（默认：5）
- `--replace-db`: 处理完成后清空原数据库并替换（⚠️ 危险操作）
- `--proxy`: 代理地址（默认：已配置的代理）

## 处理流程

1. **读取数据**：从knowledge_base表读取有答案的记录
2. **标签化处理**：
   - 有问题的记录：保持问题和答案不变，只添加标签
   - 无问题的记录：根据答案生成问题，并添加标签
3. **保存结果**：
   - 保存到JSON文件（带时间戳）
   - 可选：清空数据库并导入处理后的数据

## 输出格式

处理后的每条记录包含：
- `original_question` / `generated_question`: 问题内容
- `original_answer`: 答案内容（保持不变）
- `primary_category`: 主要分类
- `tags`: 标签数组
- `difficulty_level`: 难度等级
- `time_relevance`: 时效性
- `confidence_score`: 置信度（0-1）

## 注意事项

### ⚠️ 重要提醒
- `--replace-db` 参数会**清空原数据库**，请务必先备份数据
- 建议先用小批量数据测试效果
- API调用有频率限制，大批量处理需要时间

### 数据安全
- 处理前会自动备份到JSON文件
- 原始数据的ID等信息会保存在meta_data中
- 支持断点续传（通过offset参数）

### 性能优化
- 默认批大小为5，可根据API限制调整
- 请求间有2秒延迟避免频率限制
- 支持代理配置确保网络稳定

## 测试结果示例

成功率：100%  
平均置信度：0.9  
处理效果：
- ✅ 准确的标签分类
- ✅ 自然的问题生成  
- ✅ 完整的元数据保留

## 故障排除

1. **JSON解析错误**：检查API响应格式
2. **网络超时**：检查代理配置
3. **数据库连接失败**：检查数据库配置
4. **API调用失败**：检查API密钥和网络

## 日志文件
- `knowledge_tagger.log` - 详细处理日志
- 包含API调用、处理进度、错误信息等