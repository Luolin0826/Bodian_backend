# 话术库"一问多答"功能使用说明

## 📋 功能概述
话术库现在支持"一问多答"功能，每个问题场景可以对应最多5个不同的回复，让话术内容更加丰富和灵活。

## 🆕 新增字段说明

### 数据库字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| `answers` | JSON | 多个回复内容的JSON数组 |
| `answer_count` | INT | 实际回复数量 |
| `recommended_answer_index` | INT | 推荐回复的索引(0-based) |

### API返回数据
```json
{
  "id": 1,
  "question": "如何准备电网考试？",
  "answer": "建议先了解考试大纲...",  // 主回复（兼容性）
  "answers": [
    "建议先了解考试大纲，制定学习计划",
    "推荐购买官方教材，多做真题练习", 
    "可以报名培训班，系统性学习",
    "建议关注我们的公众号获取最新资料"
  ],
  "answer_count": 4,
  "recommended_answer_index": 0
}
```

## 📚 API接口说明

### 1. 创建话术（支持多回复）
**POST** `/api/v1/scripts`

```json
{
  "question": "如何准备电网考试？",
  "answers": [
    "建议先了解考试大纲，制定学习计划",
    "推荐购买官方教材，多做真题练习"
  ],
  "recommended_answer_index": 0,
  "category_id": 1
}
```

### 2. 更新话术（支持多回复）
**PUT** `/api/v1/scripts/{id}`

```json
{
  "answers": [
    "建议先了解考试大纲，制定学习计划",
    "推荐购买官方教材，多做真题练习",
    "可以报名培训班，系统性学习"
  ],
  "recommended_answer_index": 1
}
```

### 3. 添加新回复
**POST** `/api/v1/scripts/{id}/answers`

```json
{
  "answer": "建议关注我们的公众号获取最新资料"
}
```

### 4. 更新指定回复
**PUT** `/api/v1/scripts/{id}/answers/{index}`

```json
{
  "answer": "更新后的回复内容"
}
```

### 5. 删除指定回复
**DELETE** `/api/v1/scripts/{id}/answers/{index}`

### 6. 设置推荐回复
**PUT** `/api/v1/scripts/{id}/recommend/{index}`

## 🔄 向后兼容性

### 现有API继续工作
- 所有现有的API接口都保持不变
- 现有数据自动迁移到新结构
- `answer` 字段保留作为主回复

### 兼容单回复更新
```json
// 旧版本方式依然支持
{
  "answer": "单个回复内容"
}
```

## 💡 使用建议

### 多回复场景
1. **不同角度回答**: 同一问题的不同切入点
2. **难度分层**: 简单版、详细版回复
3. **场景适配**: 不同用户群体的回复
4. **A/B测试**: 测试不同回复的效果

### 推荐回复设置
- 设置最常用或效果最好的回复为推荐
- 前端可优先展示推荐回复
- 便于统计分析和效果评估

## ⚠️ 注意事项

### 限制说明
- 每个问题最多支持5个回复
- 至少需要保留1个回复
- 推荐索引范围: 0 到 (回复数量-1)

### 数据迁移
执行数据库迁移脚本 `add_multiple_answers_migration.sql` 后：
- 现有 `answer` 字段内容自动迁移到 `answers[0]`
- `answer_count` 设为 1
- `recommended_answer_index` 设为 0

## 🚀 前端集成建议

### 展示界面
```javascript
// 展示多个回复选项
script.answers.forEach((answer, index) => {
  const isRecommended = index === script.recommended_answer_index;
  // 渲染回复选项，标注推荐项
});
```

### 创建界面
```javascript
// 支持动态添加/删除回复
const answers = ['回复1', '回复2'];  // 最多5个
const data = {
  question: '问题内容',
  answers: answers,
  recommended_answer_index: 0
};
```

## 📈 统计分析扩展
未来可基于多回复功能扩展：
- 各回复使用频率统计
- 回复效果对比分析
- 智能推荐优化
- 用户偏好分析