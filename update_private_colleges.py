#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
批量更新学校表中民办本科院校的level分类
根据用户提供的民办本科名单进行批量更新
"""

import pandas as pd
from datetime import datetime
import os

def get_private_colleges_list():
    """获取民办本科院校名单"""
    private_colleges = [
        "北京城市学院",
        "首都师范大学科德学院",
        "北京金融科技学院",
        "北京邮电大学世纪学院",
        "北京工业大学耿丹学院",
        "北京第二外国语学院中瑞酒店管理学院",
        "天津天狮学院",
        "天津外国语大学滨海外事学院",
        "天津传媒学院",
        "天津商业大学宝德学院",
        "天津医科大学临床医学院",
        "南开大学滨海学院",
        "天津师范大学津沽学院",
        "天津理工大学中环信息学院",
        "北京科技大学天津学院",
        "天津仁爱学院",
        "天津财经大学珠江学院",
        "河北传媒学院",
        "河北工程技术学院",
        "河北美术学院",
        "河北科技学院",
        "河北外国语学院",
        "河北大学工商学院",
        "华北理工大学轻工学院",
        "河北师范大学汇华学院",
        "河北经贸大学经济管理学院",
        "河北医科大学临床学院",
        "河北工程大学科信学院",
        "燕山大学里仁学院",
        "石家庄铁道大学四方学院",
        "河北地质大学华信学院",
        "河北农业大学现代科技学院",
        "华北理工大学冀唐学院",
        "保定理工学院",
        "燕京理工学院",
        "北京中医药大学东方学院",
        "沧州交通学院",
        "河北东方学院",
        "山西应用科技学院",
        "晋中信息学院",
        "山西晋中理工学院",
        "晋中健康学院",
        "山西财经大学华商学院",
        "山西工商学院",
        "运城职业技术大学",
        "内蒙古大学创业学院",
        "内蒙古鸿德文理学院",
        "辽宁对外经贸学院",
        "辽宁理工职业大学",
        "大连理工大学城市学院",
        "沈阳工业大学工程学院",
        "沈阳航空航天大学北方科技学院",
        "沈阳工学院",
        "大连工业大学艺术与信息工程学院",
        "大连科技学院",
        "沈阳城市建设学院",
        "大连医科大学中山学院",
        "锦州医科大学医疗学院",
        "辽宁师范大学海华学院",
        "辽宁理工学院",
        "大连财经学院",
        "沈阳城市学院",
        "大连艺术学院",
        "辽宁中医药大学杏林学院",
        "辽宁何氏医学院",
        "沈阳科技学院",
        "大连东软信息学院",
        "辽宁财贸学院",
        "辽宁传媒学院",
        "吉林外国语大学",
        "长春光华学院",
        "长春工业大学人文信息学院",
        "长春电子科技学院",
        "长春财经学院",
        "吉林建筑科技学院",
        "长春建筑学院",
        "长春科技学院",
        "吉林动画学院",
        "吉林师范大学博达学院",
        "长春大学旅游学院",
        "长春人文学院",
        "黑龙江东方学院",
        "哈尔滨信息工程学院",
        "齐齐哈尔工程学院",
        "黑龙江外国语学院",
        "黑龙江财经学院",
        "哈尔滨石油学院",
        "黑龙江工商学院",
        "哈尔滨远东理工学院",
        "哈尔滨剑桥学院",
        "黑龙江工程学院昆仑旅游学院",
        "哈尔滨广厦学院",
        "哈尔滨华德学院",
        "上海杉达学院",
        "上海立达学院",
        "上海建桥学院",
        "上海兴伟学院",
        "上海中侨职业技术大学",
        "上海视觉艺术学院",
        "上海外国语大学贤达经济人文学院",
        "上海师范大学天华学院",
        "三江学院",
        "南通理工学院",
        "东南大学成贤学院",
        "无锡太湖学院",
        "中国矿业大学徐海学院",
        "南京大学金陵学院",
        "南京理工大学紫金学院",
        "南京航空航天大学金城学院",
        "南京传媒学院",
        "南京理工大学泰州科技学院",
        "南京师范大学泰州学院",
        "南京工业大学浦江学院",
        "南京师范大学中北学院",
        "南京医科大学康达学院",
        "南京中医药大学翰林学院",
        "苏州大学应用技术学院",
        "苏州科技大学天平学院",
        "江苏大学京江学院",
        "扬州大学广陵学院",
        "江苏师范大学科文学院",
        "南京邮电大学通达学院",
        "南京财经大学红山学院",
        "江苏科技大学苏州理工学院",
        "常州大学怀德学院",
        "南通大学杏林学院",
        "南京审计大学金审学院",
        "浙江树人学院",
        "浙江越秀外国语学院",
        "宁波财经学院",
        "浙江广厦建设职业技术大学",
        "浙江工业大学之江学院",
        "浙江师范大学行知学院",
        "宁波大学科学技术学院",
        "杭州电子科技大学信息工程学院",
        "浙江理工大学科技与艺术学院",
        "浙江农林大学暨阳学院",
        "温州医科大学仁济学院",
        "浙江中医药大学滨江学院",
        "杭州师范大学钱江学院",
        "浙江工商大学杭州商学院",
        "中国计量大学现代科技学院",
        "浙江财经大学东方学院",
        "温州商学院",
        "同济大学浙江学院",
        "上海财经大学浙江学院",
        "西湖大学",
        "宁波东方理工大学",
        "安徽三联学院",
        "安徽新华学院",
        "安徽文达信息工程学院",
        "安徽外国语学院",
        "蚌埠工商学院",
        "安徽信息工程学院",
        "马鞍山学院",
        "合肥城市学院",
        "合肥经济学院",
        "芜湖学院",
        "安徽医科大学临床医学院",
        "阜阳理工学院",
        "淮北理工学院",
        "皖江工学院",
        "仰恩大学",
        "厦门华厦学院",
        "闽南理工学院",
        "泉州职业技术大学",
        "闽南科技学院",
        "福州工商学院",
        "厦门工学院",
        "阳光学院",
        "厦门大学嘉庚学院",
        "福州大学至诚学院",
        "集美大学诚毅学院",
        "福建师范大学协和学院",
        "福州外语外贸学院",
        "泉州信息工程学院",
        "福州理工学院",
        "福建农林大学金山学院",
        "福建福耀科技大学",
        "江西科技学院",
        "江西工程学院",
        "南昌理工学院",
        "江西应用科技学院",
        "江西服装学院",
        "南昌职业大学",
        "南昌工学院",
        "南昌大学科学技术学院",
        "南昌大学共青学院",
        "南昌交通学院",
        "南昌航空大学科技学院",
        "景德镇艺术职业大学",
        "江西农业大学南昌商学院",
        "江西师范大学科学技术学院",
        "赣南师范大学科技学院",
        "南昌应用技术师范学院",
        "江西财经大学现代经济管理学院",
        "江西软件职业技术大学",
        "九江科技职业大学",
        "齐鲁医药学院",
        "青岛滨海学院",
        "烟台南山学院",
        "潍坊科技学院",
        "山东英才学院",
        "青岛恒星科技学院",
        "青岛黄海学院",
        "山东现代学院",
        "山东协和学院",
        "山东工程职业技术大学",
        "烟台理工学院",
        "聊城大学东昌学院",
        "青岛城市学院",
        "潍坊理工学院",
        "山东财经大学燕山学院",
        "山东外国语职业技术大学",
        "泰山科技学院",
        "山东华宇工学院",
        "山东外事职业大学",
        "青岛工学院",
        "青岛农业大学海都学院",
        "齐鲁理工学院",
        "山东财经大学东方学院",
        "烟台科技学院",
        "青岛电影学院",
        "黄河科技学院",
        "郑州科技学院",
        "郑州工业应用技术学院",
        "郑州财经学院",
        "黄河交通学院",
        "商丘工学院",
        "河南开封科技传媒学院",
        "中原科技学院",
        "信阳学院",
        "安阳学院",
        "豫北医学院",
        "新乡工程学院",
        "郑州工商学院",
        "郑州经贸学院",
        "商丘学院",
        "郑州商学院",
        "河南科技职业大学",
        "郑州升达经贸管理学院",
        "郑州西亚斯学院",
        "郑州美术学院",
        "漯河食品工程职业大学",
        "郑州健康学院",
        "武汉东湖学院",
        "汉口学院",
        "武昌首义学院",
        "武昌理工学院",
        "武汉生物工程学院",
        "武汉晴川学院",
        "湖北大学知行学院",
        "武汉城市学院",
        "三峡大学科技学院",
        "武汉文理学院",
        "湖北工业大学工程技术学院",
        "武汉工程大学邮电与信息工程学院",
        "武汉纺织大学外经贸学院",
        "武昌工学院",
        "武汉工商学院",
        "荆州学院",
        "长江大学文理学院",
        "湖北商贸学院",
        "湖北汽车工业学院科技学院",
        "湖北医药学院药护学院",
        "湖北恩施学院",
        "湖北经济学院法商学院",
        "武汉体育学院体育科技学院",
        "湖北师范大学文理学院",
        "湖北文理学院理工学院",
        "湖北工程学院新技术学院",
        "文华学院",
        "武汉学院",
        "武汉工程科技学院",
        "武汉华夏理工学院",
        "武汉传媒学院",
        "武汉设计工程学院",
        "湖北三峡航空学院",
        "长沙医学院",
        "湖南涉外经济学院",
        "湘潭大学兴湘学院",
        "湖南工业大学科技学院",
        "湖南科技大学潇湘学院",
        "南华大学船山学院",
        "湘潭理工学院",
        "湖南农业大学东方科技学院",
        "中南林业科技大学涉外学院",
        "常德学院",
        "岳阳学院",
        "衡阳师范学院南岳学院",
        "湖南工程学院应用技术学院",
        "湖南中医药大学湘杏学院",
        "张家界学院",
        "长沙理工大学城南学院",
        "湖南应用技术学院",
        "湖南信息学院",
        "湖南交通工程学院",
        "湖南软件职业技术大学",
        "长沙科技学院",
        "广东白云学院",
        "电子科技大学中山学院",
        "广东培正学院",
        "广东东软学院",
        "广州城市理工学院",
        "广州软件学院",
        "广州南方学院",
        "广东外语外贸大学南国商学院",
        "广州华商学院",
        "湛江科技学院",
        "华南农业大学珠江学院",
        "广州理工学院",
        "北京师范大学珠海分校",
        "广州华立学院",
        "广州应用科技学院",
        "广州商学院",
        "北京理工大学珠海学院",
        "珠海科技学院",
        "广州工商学院",
        "广州科技职业技术大学",
        "广东科技学院",
        "广东理工学院",
        "广东工商职业技术大学",
        "东莞城市学院",
        "广州新华学院",
        "南宁学院",
        "北海艺术设计学院",
        "柳州工学院",
        "广西民族大学相思湖学院",
        "桂林学院",
        "南宁师范大学师园学院",
        "广西中医药大学赛恩斯新医药学院",
        "桂林信息科技学院",
        "南宁理工学院",
        "广西外国语学院",
        "北京航空航天大学北海学院",
        "广西城市职业大学",
        "海口经济学院",
        "三亚学院",
        "海南科技职业大学",
        "重庆机电职业技术大学",
        "重庆工程学院",
        "重庆城市科技学院",
        "重庆人文科技学院",
        "重庆外语外事学院",
        "重庆对外经贸学院",
        "重庆财经学院",
        "重庆工商大学派斯学院",
        "重庆移通学院",
        "成都东软学院",
        "成都艺术职业大学",
        "电子科技大学成都学院",
        "成都理工大学工程技术学院",
        "四川传媒学院",
        "成都银杏酒店管理学院",
        "成都文理学院",
        "四川工商学院",
        "成都外国语学院",
        "四川工业科技学院",
        "成都锦城学院",
        "西南财经大学天府学院",
        "四川大学锦江学院",
        "四川文化艺术学院",
        "绵阳城市学院",
        "西南交通大学希望学院",
        "四川电影电视学院",
        "吉利学院",
        "贵州中医药大学时珍学院",
        "贵州黔南经济学院",
        "贵州黔南科技学院",
        "贵阳信息科技学院",
        "贵阳人文科技学院",
        "遵义医科大学医学与科技学院",
        "贵州医科大学神奇民族医药学院",
        "茅台学院",
        "云南经济管理学院",
        "滇池学院",
        "丽江文化旅游学院",
        "昆明理工大学津桥学院",
        "昆明城市学院",
        "昆明文理学院",
        "昆明医科大学海源学院",
        "昆明传媒学院",
        "云南工商学院",
        "西安培华学院",
        "西安欧亚学院",
        "西安外事学院",
        "西安翻译学院",
        "西京学院",
        "西安思源学院",
        "陕西国际商贸学院",
        "陕西服装工程学院",
        "西安交通工程学院",
        "西安交通大学城市学院",
        "西北大学现代学院",
        "西安建筑科技大学华清学院",
        "西安财经大学行知学院",
        "陕西科技大学镐京学院",
        "西安工商学院",
        "延安大学西安创新学院",
        "西安电子科技大学长安学院",
        "西安汽车职业大学",
        "西安明德理工学院",
        "西安信息职业大学",
        "长安大学兴华学院",
        "西安理工大学高科学院",
        "西安科技大学高新学院",
        "兰州工商学院",
        "兰州博文科技学院",
        "兰州信息科技学院",
        "青海大学昆仑学院",
        "宁夏理工学院",
        "宁夏大学新华学院",
        "银川能源学院",
        "银川科技学院",
        "新疆农业大学科学技术学院",
        "新疆天山职业技术大学",
        "塔里木理工学院"
    ]
    
    return private_colleges

def update_school_levels(input_file, output_file, backup_file):
    """更新学校level分类"""
    
    # 获取民办本科名单
    private_colleges = get_private_colleges_list()
    private_colleges_set = set(private_colleges)
    
    # 读取原数据
    print(f"正在读取数据文件: {input_file}")
    df = pd.read_excel(input_file)
    
    # 备份原文件
    print(f"创建备份文件: {backup_file}")
    df.to_excel(backup_file, index=False, engine='openpyxl')
    
    # 统计信息
    total_schools = len(df)
    matched_schools = []
    updated_count = 0
    
    print(f"\n开始更新处理，共{total_schools}所学校")
    print(f"民办本科名单包含{len(private_colleges)}所学校")
    
    # 遍历数据进行更新
    for index, row in df.iterrows():
        school_name = str(row.get('standard_name', ''))
        current_level = str(row.get('level', ''))
        
        if school_name in private_colleges_set:
            matched_schools.append({
                'school_name': school_name,
                'old_level': current_level,
                'new_level': '民办本科'
            })
            
            # 更新level
            if current_level != '民办本科':
                df.at[index, 'level'] = '民办本科'
                updated_count += 1
    
    # 保存更新后的数据
    print(f"\n正在保存更新后的数据到: {output_file}")
    df.to_excel(output_file, index=False, engine='openpyxl')
    
    # 生成详细报告
    generate_update_report(matched_schools, updated_count, len(private_colleges))
    
    return matched_schools, updated_count

def generate_update_report(matched_schools, updated_count, total_private_count):
    """生成更新报告"""
    
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    report_file = f'/workspace/民办本科更新报告_{timestamp}.txt'
    
    print(f"\n=== 民办本科level更新报告 ===")
    print(f"处理时间: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    print(f"提供的民办本科名单: {total_private_count} 所")
    print(f"在数据库中找到匹配: {len(matched_schools)} 所")
    print(f"实际更新的学校: {updated_count} 所")
    
    # 按原分类统计
    level_stats = {}
    for school in matched_schools:
        old_level = school['old_level']
        level_stats[old_level] = level_stats.get(old_level, 0) + 1
    
    print(f"\n按原分类统计更新情况:")
    for level, count in sorted(level_stats.items()):
        print(f"  {level} -> 民办本科: {count} 所")
    
    # 显示匹配的学校
    print(f"\n找到的民办本科院校明细:")
    for i, school in enumerate(matched_schools, 1):
        status = "✓ 已更新" if school['old_level'] != '民办本科' else "- 无需更新"
        print(f"{i:3d}. {school['school_name']} ({school['old_level']} -> {school['new_level']}) {status}")
    
    # 查找未匹配的学校
    private_colleges = get_private_colleges_list()
    matched_names = {school['school_name'] for school in matched_schools}
    unmatched = [name for name in private_colleges if name not in matched_names]
    
    if unmatched:
        print(f"\n⚠️  未在数据库中找到的民办本科院校 ({len(unmatched)}所):")
        for i, name in enumerate(unmatched, 1):
            print(f"{i:3d}. {name}")
    
    # 保存详细报告
    with open(report_file, 'w', encoding='utf-8') as f:
        f.write(f"民办本科Level更新详细报告\n")
        f.write(f"=" * 50 + "\n")
        f.write(f"处理时间: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")
        f.write(f"提供的民办本科名单: {total_private_count} 所\n")
        f.write(f"在数据库中找到匹配: {len(matched_schools)} 所\n")
        f.write(f"实际更新的学校: {updated_count} 所\n\n")
        
        f.write("按原分类统计更新情况:\n")
        for level, count in sorted(level_stats.items()):
            f.write(f"  {level} -> 民办本科: {count} 所\n")
        
        f.write("\n找到的民办本科院校明细:\n")
        for i, school in enumerate(matched_schools, 1):
            status = "已更新" if school['old_level'] != '民办本科' else "无需更新"
            f.write(f"{i:3d}. {school['school_name']} ({school['old_level']} -> {school['new_level']}) {status}\n")
        
        if unmatched:
            f.write(f"\n未在数据库中找到的民办本科院校 ({len(unmatched)}所):\n")
            for i, name in enumerate(unmatched, 1):
                f.write(f"{i:3d}. {name}\n")
    
    print(f"\n📊 详细报告已保存到: {report_file}")

def main():
    input_file = '/workspace/学校.xlsx'
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    output_file = f'/workspace/学校_更新后_{timestamp}.xlsx'
    backup_file = f'/workspace/学校_备份_{timestamp}.xlsx'
    
    try:
        matched_schools, updated_count = update_school_levels(input_file, output_file, backup_file)
        
        print(f"\n✅ 处理完成!")
        print(f"   原文件备份: {backup_file}")
        print(f"   更新后文件: {output_file}")
        print(f"   匹配学校: {len(matched_schools)} 所")
        print(f"   实际更新: {updated_count} 所")
        
    except Exception as e:
        print(f"❌ 处理过程中出现错误: {e}")

if __name__ == '__main__':
    main()